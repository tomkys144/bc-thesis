name: Publishing notes

on:
    workflow_dispatch:
    push:
        branches:
            - main
        paths:
            - 'notes/*'

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Logseq Publish
              uses: pengx17/logseq-publish@v0.1
              with:
                version: latest
                src: 'notes'
                dest: '_site'
            - name: Add a nojekyll file
              run: touch $GITHUB_WORKSPACE/www/.nojekyll
            - name: Upload artifact
              uses: actions/upload-pages-artifact@v3
    deploy:
        environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        needs: build
        steps:
        - name: Deploy to GitHub Pages
            id: deployment
            uses: actions/deploy-pages@v4
